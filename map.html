<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä¸€éµå®šä½ & å¯„é€åº§æ¨™</title>
  <meta name="color-scheme" content="light dark" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+TC:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg1:#0b0b12; --bg2:#121326; --card:rgba(255,255,255,.06);
      --ink:#eaeaff; --muted:#a6a6c9; --accent:#8b7bff; --accent2:#ffe94d; --ok:#42d392; --warn:#ffb74d; --err:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:"Inter","Noto Sans TC", system-ui, -apple-system, Segoe UI, Roboto, "PingFang TC", "Microsoft JhengHei", sans-serif;
      color:var(--ink); background: radial-gradient(1200px 800px at 20% -20%, #1b1c3a 0%, transparent 60%), linear-gradient(160deg, var(--bg1), var(--bg2));
      display:grid; place-items:center; padding:24px;
    }
    .wrap{width:min(920px,100%);}
    .card{
      background:var(--card); backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.08); box-shadow:0 20px 60px rgba(0,0,0,.35);
      border-radius:24px; padding:24px; overflow:hidden;
    }
    h1{font-size:clamp(24px,3.6vw,36px); letter-spacing:.3px; margin:0 0 6px 0}
    p.lead{color:var(--muted); margin:0 0 16px 0}
    .grid{display:grid; gap:16px}
    .actions{display:flex; gap:12px; flex-wrap:wrap}
    button, a.button{
      appearance:none; border:none; cursor:pointer; text-decoration:none;
      padding:12px 16px; border-radius:14px; font-weight:600; font-size:15px;
      background:linear-gradient(180deg, var(--accent), #6c5cff);
      color:white; box-shadow:0 10px 24px rgba(124,108,255,.35);
      transition:.2s transform ease, .2s filter ease, .2s box-shadow ease;
    }
    button.secondary, a.button.secondary{background:#2a2b49; color:#e8e8ff; box-shadow:none; border:1px solid rgba(255,255,255,.06)}
    button:disabled{filter:saturate(.4) brightness(.8); cursor:not-allowed}
    button:hover, a.button:hover{transform:translateY(-1px); box-shadow:0 14px 28px rgba(124,108,255,.45)}
    .kv{display:grid; grid-template-columns:140px 1fr; gap:8px 12px; align-items:center}
    .kv .k{color:var(--muted)} .kv .v{word-break:break-all}
    .status{margin-top:6px; font-size:14px}
    .status.ok{color:var(--ok)} .status.warn{color:var(--warn)} .status.err{color:var(--err)}
    .note{color:var(--muted); font-size:13px}
    .mapbox{background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:12px;}
    input, textarea{width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:rgba(0,0,0,.2); color:var(--ink)}
    label{font-size:14px; color:var(--muted)}
    .row{display:grid; gap:10px; grid-template-columns:1fr 1fr}
    @media (max-width:620px){.row{grid-template-columns:1fr} .kv{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ä¸€éµå®šä½ & ç”¨ Gmail å‚³çµ¦å°æ–¹ ğŸ“¡âœ‰ï¸</h1>
      <p class="lead">é»ä¸€ä¸‹å°±å–å¾—ä½ ç¾åœ¨çš„ç¶“ç·¯åº¦èˆ‡ç²¾ç¢ºåº¦ï¼Œä¸¦è‡ªå‹•ç”¢ç”Ÿ Gmail è‰ç¨¿ï¼ˆå« Google åœ°åœ–é€£çµï¼‰ã€‚</p>
      <div class="grid">
        <div class="actions">
          <button id="btnGet">ğŸ“ å–å¾—æˆ‘çš„ä½ç½®</button>
          <button id="btnCopy" class="secondary" disabled>ğŸ“‹ è¤‡è£½åº§æ¨™</button>
          <a id="btnGmail" class="button" target="_blank" rel="noopener" style="display:none">âœ‰ï¸ ç”¨ Gmail å‚³é€</a>
          <a id="btnMailto" class="button secondary" target="_blank" rel="noopener" style="display:none">âœ‰ï¸ï¼ˆå‚™ç”¨ï¼‰ç”¨é è¨­ä¿¡ç®±</a>
        </div>

        <div class="row">
          <div>
            <label for="to">æ”¶ä»¶è€… Emailï¼ˆå¿…å¡«ï¼‰</label>
            <input id="to" type="email" placeholder="someone@example.com" />
          </div>
          <div>
            <label for="subj">ä¸»æ—¨</label>
            <input id="subj" type="text" placeholder="æˆ‘çš„å³æ™‚åº§æ¨™" />
          </div>
        </div>

        <div>
          <label for="msg">è‡ªè¨‚è¨Šæ¯ï¼ˆé¸å¡«ï¼‰</label>
          <textarea id="msg" rows="3" placeholder="é€™æ˜¯æˆ‘çš„ä½ç½®ï¼Œéº»ç…©ç•™æ„ï½"></textarea>
        </div>

        <div class="mapbox">
          <div class="kv">
            <div class="k">ç·¯åº¦ (lat)</div>
            <div class="v" id="lat">â€”</div>
            <div class="k">ç¶“åº¦ (lng)</div>
            <div class="v" id="lng">â€”</div>
            <div class="k">ç²¾ç¢ºåº¦</div>
            <div class="v" id="acc">â€”</div>
            <div class="k">Google åœ°åœ–</div>
            <div class="v"><a id="mapLink" href="#" target="_blank" rel="noopener">â€”</a></div>
          </div>
          <div id="status" class="status">å°šæœªå–å¾—å®šä½</div>
          <div class="note">æç¤ºï¼šå®šä½éœ€è¦ HTTPS ç¶²ç«™æˆ–æœ¬æ©Ÿ <code>localhost</code>ã€‚è‹¥ä½ é—œé–‰æ¬Šé™ï¼Œè«‹åˆ°ç€è¦½å™¨è¨­å®šé‡æ–°é–‹å•Ÿå®šä½æ¬Šé™ã€‚</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const btnGet = document.getElementById('btnGet');
    const btnCopy = document.getElementById('btnCopy');
    const btnGmail = document.getElementById('btnGmail');
    const btnMailto = document.getElementById('btnMailto');
    const latEl = document.getElementById('lat');
    const lngEl = document.getElementById('lng');
    const accEl = document.getElementById('acc');
    const statusEl = document.getElementById('status');
    const mapLink = document.getElementById('mapLink');

    const toEl = document.getElementById('to');
    const subjEl = document.getElementById('subj');
    const msgEl = document.getElementById('msg');

    let lastPos = null;

    function setStatus(text, cls){
      statusEl.className = 'status ' + (cls||'');
      statusEl.textContent = text;
    }

    function buildMapUrl(lat, lng){
      return `https://maps.google.com/?q=${lat},${lng}`;
    }

    function buildBody(lat, lng, acc){
      const lines = [
        `åº§æ¨™ï¼š${lat}, ${lng}`,
        acc? `ç²¾ç¢ºåº¦ï¼šç´„ ${acc} å…¬å°º` : null,
        `åœ°åœ–ï¼š${buildMapUrl(lat,lng)}`,
        '',
        msgEl.value?.trim()? msgEl.value.trim() : ''
      ].filter(Boolean);
      return lines.join('\n');
    }

    function encode(v){ return encodeURIComponent(v || ''); }

    function updateLinks(){
      if(!lastPos) return;
      const to = toEl.value.trim();
      const subj = subjEl.value.trim() || 'æˆ‘çš„å³æ™‚åº§æ¨™';
      const body = buildBody(lastPos.lat, lastPos.lng, lastPos.acc);

      // Gmail ç¶²é ç‰ˆ
      const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${encode(to)}&su=${encode(subj)}&body=${encode(body)}`;
      btnGmail.href = gmailUrl;

      // å‚™ç”¨ï¼šmailtoï¼ˆè¡Œå‹•è£ç½®å¯ç›´æ¥å–šèµ· Gmail/é è¨­ä¿¡ç®±ï¼‰
      const mailtoUrl = `mailto:${encode(to)}?subject=${encode(subj)}&body=${encode(body)}`;
      btnMailto.href = mailtoUrl;

      // è‹¥å¡«äº†æ”¶ä»¶è€…å°±é¡¯ç¤ºæŒ‰éˆ•
      const show = !!to;
      btnGmail.style.display = show ? 'inline-block' : 'none';
      btnMailto.style.display = show ? 'inline-block' : 'none';
    }

    function onSuccess(pos){
      const { latitude, longitude, accuracy } = pos.coords;
      lastPos = { lat: latitude.toFixed(8), lng: longitude.toFixed(8), acc: Math.round(accuracy) };
      latEl.textContent = lastPos.lat;
      lngEl.textContent = lastPos.lng;
      accEl.textContent = isFinite(lastPos.acc)? `${lastPos.acc} m` : 'â€”';
      const url = buildMapUrl(lastPos.lat, lastPos.lng);
      mapLink.textContent = url; mapLink.href = url;
      btnCopy.disabled = false;
      setStatus('å®šä½æˆåŠŸ âœ“', 'ok');
      updateLinks();
    }

    function onError(err){
      console.error(err);
      let msg = 'å®šä½å¤±æ•—';
      if(err.code === 1) msg += 'ï¼šæ¬Šé™è¢«æ‹’çµ•ï¼ˆè«‹åˆ°ç€è¦½å™¨è¨­å®šé–‹å•Ÿå®šä½ï¼‰';
      else if(err.code === 2) msg += 'ï¼šä½ç½®ä¸å¯ç”¨ï¼ˆæª¢æŸ¥ç¶²è·¯ / GPSï¼‰';
      else if(err.code === 3) msg += 'ï¼šé€¾æ™‚ï¼ˆè«‹å†è©¦ä¸€æ¬¡ï¼‰';
      setStatus(msg, 'err');
    }

    btnGet.addEventListener('click', () => {
      if(!('geolocation' in navigator)){
        setStatus('æ­¤è£ç½®ä¸æ”¯æ´ Geolocation API', 'err');
        return;
      }
      setStatus('å®šä½ä¸­â€¦', 'warn');
      navigator.geolocation.getCurrentPosition(onSuccess, onError, {
        enableHighAccuracy: true, timeout: 15000, maximumAge: 0
      });
    });

    btnCopy.addEventListener('click', async () => {
      if(!lastPos) return;
      const text = `${lastPos.lat}, ${lastPos.lng}`;
      try{ await navigator.clipboard.writeText(text); setStatus('å·²è¤‡è£½åº§æ¨™åˆ°å‰ªè²¼ç°¿', 'ok'); }
      catch{ setStatus('ç„¡æ³•è¤‡è£½ï¼Œè«‹æ‰‹å‹•é¸å–è¤‡è£½', 'warn'); }
    });

    toEl.addEventListener('input', updateLinks);
    subjEl.addEventListener('input', updateLinks);
    msgEl.addEventListener('input', updateLinks);
  </script>
</body>
</html>
