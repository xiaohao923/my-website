<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PDF Reader</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
    body {
        margin: 0;
        background: #111;
        overflow: hidden;
        font-family: -apple-system, BlinkMacSystemFont, "PingFang TC",
                     "Microsoft JhengHei", sans-serif;
        touch-action: manipulation;
    }

    /* ===================== 帥氣工具列 ===================== */
    #toolbar {
        height: 58px;
        background: linear-gradient(180deg, #1a1a1a, #0f0f0f);
        display: flex;
        align-items: center;
        padding: 0 14px;
        gap: 10px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.5);
        color: white;
        position: relative;
        z-index: 10;
    }

    button {
        padding: 8px 14px;
        border-radius: 10px;
        background: #222;
        color: white;
        border: 1px solid #333;
        font-size: 15px;
        transition: 0.2s;
    }

    button:active {
        transform: scale(0.94);
        background: #333;
    }

    #pageInfo {
        margin-left: auto;
        margin-right: 10px;
        font-size: 15px;
        opacity: 0.9;
    }

    /* ===================== PDF 區域 ===================== */
    #viewerContainer {
        height: calc(100vh - 58px);
        overflow-y: auto;
        background: #1b1b1b;
        padding: 25px 0;
        -webkit-overflow-scrolling: touch;
    }

    canvas {
        display: block;
        margin: 0 auto;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0,0,0,0.35);
        touch-action: none; /* 禁止 Safari 亂放大 */
    }
</style>
</head>
<body>

<div id="toolbar">
    <button onclick="prevPage()">⬅</button>
    <button onclick="nextPage()">➡</button>

    <button onclick="zoomOut()">－</button>
    <button onclick="zoomIn()">＋</button>
    <button onclick="resetZoom()">⟳ 重置</button>

    <span id="pageInfo">1 / ?</span>
</div>

<div id="viewerContainer">
    <canvas id="pdfCanvas"></canvas>
</div>

<script>
const url = "114福誠高中學生手冊.pdf";

let pdfDoc = null;
let pageNum = 1;
let scale = 1.15;
const canvas = document.getElementById("pdfCanvas");
const ctx = canvas.getContext("2d");

pdfjsLib.getDocument(url).promise.then(pdf => {
    pdfDoc = pdf;
    renderPage(pageNum);
});

/* ===================== 高清渲染 ===================== */
function renderPage(num) {
    pdfDoc.getPage(num).then(page => {
        const dpi = window.devicePixelRatio || 2;

        const viewport = page.getViewport({
            scale: scale * dpi
        });

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        // 顯示大小（非實際渲染大小）
        canvas.style.width = (viewport.width / dpi) + "px";
        canvas.style.height = (viewport.height / dpi) + "px";

        page.render({
            canvasContext: ctx,
            viewport
        });

        document.getElementById("pageInfo").innerText =
            `${num} / ${pdfDoc.numPages}`;
    });
}

/* ===================== 工具列功能 ===================== */
function prevPage() {
    if (pageNum <= 1) return;
    pageNum--;
    renderPage(pageNum);
}

function nextPage() {
    if (pageNum >= pdfDoc.numPages) return;
    pageNum++;
    renderPage(pageNum);
}

function zoomIn() {
    scale += 0.20;
    renderPage(pageNum);
}

function zoomOut() {
    if (scale <= 0.4) return;
    scale -= 0.20;
    renderPage(pageNum);
}

function resetZoom() {
    scale = 1.15;
    renderPage(pageNum);
}

/* ===================== 禁止 iPhone 雙擊放大 ===================== */
document.addEventListener('touchstart', function(e) {
    if (e.touches.length > 1) e.preventDefault();
}, { passive: false });

document.addEventListener('dblclick', function(e) {
    e.preventDefault();
}, { passive: false });

</script>

</body>
</html>