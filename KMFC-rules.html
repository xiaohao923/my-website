<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>福誠高中學生手冊</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
    body {
        margin: 0;
        background: #111;
        font-family: -apple-system, "PingFang TC", sans-serif;
        overflow: hidden;
        touch-action: manipulation;
    }

    /* 工具列 */
    #toolbar {
        height: 58px;
        background: rgba(0,0,0,0.88);
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 0 14px;
        color: white;
        box-shadow: 0 2px 12px rgba(0,0,0,0.5);
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 20;
        transition: opacity 0.25s;
    }

    button {
        padding: 8px 14px;
        border-radius: 8px;
        background: #222;
        color: #fff;
        border: none;
        font-size: 15px;
        transition: 0.2s;
    }

    button:active { transform: scale(0.92); }

    #pageInfo {
        margin-left: auto;
        opacity: 0.85;
        font-size: 15px;
    }

    /* PDF 區域 */
    #viewerContainer {
        height: 100vh;
        background: #1a1a1a;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        text-align: center;
    }

    canvas {
        width: 100% !important;
        height: auto !important;
        margin-top: 70px;
        background: white;
        border-radius: 6px;
        box-shadow: 0 0 20px rgba(0,0,0,0.4);
        transition: opacity 0.25s;
    }

    /* 動畫淡入 */
    .fade {
        opacity: 0;
    }
</style>
</head>
<body>

<div id="toolbar">
    <button onclick="prevPage()">⬅</button>
    <button onclick="nextPage()">➡</button>

    <button onclick="jumpPage()">輸入頁碼</button>

    <span id="pageInfo">1 / ?</span>
</div>

<div id="viewerContainer">
    <canvas id="pdfCanvas"></canvas>
</div>

<script>
const url = "114福誠高中學生手冊.pdf";

let pdfDoc = null;
let pageNum = 1;
let scale = 1.6;
const canvas = document.getElementById("pdfCanvas");
const ctx = canvas.getContext("2d");
let toolbarVisible = true;

/* ===================== 載入 PDF ===================== */
pdfjsLib.getDocument(url).promise.then(pdf => {
    pdfDoc = pdf;
    renderPage(pageNum);
});

/* ===================== 渲染頁面（含淡入動畫） ===================== */
function renderPage(num) {
    canvas.classList.add("fade");

    pdfDoc.getPage(num).then(page => {
        const dpi = window.devicePixelRatio || 2;
        const viewport = page.getViewport({ scale: scale * dpi });

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        page.render({ canvasContext: ctx, viewport });

        document.getElementById("pageInfo").innerText =
            `${num} / ${pdfDoc.numPages}`;

        setTimeout(() => canvas.classList.remove("fade"), 50);
    });
}

/* ===================== 基本功能 ===================== */
function prevPage() {
    if (pageNum <= 1) return;
    pageNum--;
    renderPage(pageNum);
}

function nextPage() {
    if (pageNum >= pdfDoc.numPages) return;
    pageNum++;
    renderPage(pageNum);
}

function jumpPage() {
    const page = prompt("輸入頁碼 (1 - " + pdfDoc.numPages + "):");
    const num = parseInt(page);

    if (!isNaN(num) && num >= 1 && num <= pdfDoc.numPages) {
        pageNum = num;
        renderPage(pageNum);
    }
}

/* ===================== 手勢：左右滑動換頁 ===================== */
let touchX = 0;

canvas.addEventListener("touchstart", e => {
    touchX = e.touches[0].clientX;
});

canvas.addEventListener("touchend", e => {
    let diff = e.changedTouches[0].clientX - touchX;

    if (diff > 80) prevPage();
    else if (diff < -80) nextPage();
});

/* ===================== 輕點 PDF → 顯示/隱藏工具列 ===================== */
canvas.addEventListener("click", () => {
    toolbarVisible = !toolbarVisible;
    document.getElementById("toolbar").style.opacity = toolbarVisible ? 1 : 0;
});

/* ===================== 阻止 iPhone Safari 自動放大 ===================== */
document.addEventListener('touchstart', e => {
    if (e.touches.length > 1) e.preventDefault();
}, { passive: false });

document.addEventListener('dblclick', e => e.preventDefault(), { passive: false });

</script>

</body>
</html>