<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>福誠高中學生手冊</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
    body {
        margin: 0;
        background: #0d0d0d;
        font-family: -apple-system, "PingFang TC", sans-serif;
        overflow: hidden;
    }

    /* ===== 最帥玻璃模糊工具列 ===== */
    #toolbar {
        height: 60px;
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        background: rgba(20,20,20,0.55);
        display: flex;
        align-items: center;
        padding: 0 16px;
        gap: 12px;
        color: white;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 50;
        border-bottom: 1px solid rgba(255,255,255,0.07);
        transition: opacity 0.3s ease;
    }

    button {
        padding: 8px 16px;
        background: rgba(255,255,255,0.09);
        border: 1px solid rgba(255,255,255,0.13);
        color: #fff;
        border-radius: 10px;
        font-size: 15px;
        transition: 0.2s;
    }

    button:active {
        transform: scale(0.92);
        background: rgba(255,255,255,0.18);
    }

    /* ⭐ 頁碼永遠不會被擋住（置中靠右） */
    #pageInfo {
        margin-left: auto;
        font-size: 15px;
        opacity: 0.9;
        padding-right: 6px;
        font-weight: 500;
    }

    /* ===== PDF 區 ===== */
    #viewerContainer {
        height: 100vh;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        background: #141414;
        text-align: center;
    }

    canvas {
        width: 100% !important;
        max-width: 880px !important; /* 避免太大、超好看 */
        margin: 80px auto 20px auto;
        background: white;
        border-radius: 6px;
        box-shadow: 0 0 26px rgba(0,0,0,0.45);
        transition: opacity 0.28s ease;
    }

    .fade {
        opacity: 0;
    }
</style>
</head>
<body>

<div id="toolbar">
    <button onclick="prevPage()">⬅ 上一頁</button>
    <button onclick="nextPage()">下一頁 ➡</button>
    <button onclick="jumpPage()">跳到頁碼</button>

    <span id="pageInfo">1 / ?</span>
</div>

<div id="viewerContainer">
    <canvas id="pdfCanvas"></canvas>
</div>

<script>
const url = "114福誠高中學生手冊.pdf";

let pdfDoc = null;
let pageNum = 1;
let scale = 1.15; // 不會太大、也不會糊
const canvas = document.getElementById("pdfCanvas");
const ctx = canvas.getContext("2d");
let toolbarVisible = true;

/* 載入 PDF */
pdfjsLib.getDocument(url).promise.then(pdf => {
    pdfDoc = pdf;
    renderPage(pageNum);
});

/* 渲染頁面（含淡入動畫） */
function renderPage(num) {
    canvas.classList.add("fade");

    pdfDoc.getPage(num).then(page => {
        const dpi = window.devicePixelRatio || 2;

        const viewport = page.getViewport({
            scale: scale * dpi
        });

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        page.render({
            canvasContext: ctx,
            viewport
        });

        document.getElementById("pageInfo").innerText =
            `${num} / ${pdfDoc.numPages}`;

        setTimeout(() => canvas.classList.remove("fade"), 40);
    });
}

/* 基本功能 */
function prevPage() {
    if (pageNum <= 1) return;
    pageNum--;
    renderPage(pageNum);
}

function nextPage() {
    if (pageNum >= pdfDoc.numPages) return;
    pageNum++;
    renderPage(pageNum);
}

function jumpPage() {
    const page = prompt("請輸入頁碼（1 - " + pdfDoc.numPages + "）");
    const num = parseInt(page);

    if (!isNaN(num) && num >= 1 && num <= pdfDoc.numPages) {
        pageNum = num;
        renderPage(pageNum);
    }
}

/* ====== 左右滑動換頁（更靈敏） ====== */
let touchX = 0;

canvas.addEventListener("touchstart", e => {
    touchX = e.touches[0].clientX;
});

canvas.addEventListener("touchend", e => {
    let diff = e.changedTouches[0].clientX - touchX;

    if (diff > 40) prevPage();
    else if (diff < -40) nextPage();
});

/* 點擊隱藏/顯示工具列 */
canvas.addEventListener("click", () => {
    toolbarVisible = !toolbarVisible;
    document.getElementById("toolbar").style.opacity = toolbarVisible ? 1 : 0;
});

/* 禁止 iPhone 自動放大 */
document.addEventListener('touchstart', e => {
    if (e.touches.length > 1) e.preventDefault();
}, { passive: false });

document.addEventListener('dblclick', e => e.preventDefault(), { passive: false });
</script>

</body>
</html>